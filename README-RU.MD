# Statka â€” ĞÑ‡ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ´Ğ»Ñ Web

**Statka** â€” Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€.
ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· **GET / POST** (query string, POST JSON, POST Form), Ğ±ÑƒÑ„ĞµÑ€Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ Ğ¸ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ N ÑĞµĞºÑƒĞ½Ğ´ ÑĞ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ±Ğ°Ñ‚Ñ‡Ğ°Ğ¼Ğ¸ Ğ² **ClickHouse**.

## ĞšĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞ¹Ñ‚Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¿Ğ¾ HTTP Ğ½Ğ° ÑĞ²Ğ¾Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ Ğ² **Statka**:
`POST /my_another_table {"my_string": "qqq", "my_int": 123}`

Ğ˜ Ğ·Ğ°Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ Ğ¸Ğ· **ClickHouse** Ñ‚Ğ°Ğº:
```sql
SELECT my_string
FROM my_another_table
WHERE my_int >= 123
```

## ğŸ› ï¸ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°
```shell
git clone https://github.com/andrylavr/statka
cd statka
make
sudo make install
make clean
systemctl status statka
```

âœ… ĞŸĞ¾ÑĞ»Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ±ÑƒĞ´ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ½Ğ° http://localhost:8080! ğŸš€
Ğ’Ñ‹ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ñ€Ñ‚ Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğµ `/opt/statka/statka.json`

## âš™ï¸ Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ° Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸
```shell
sudo nano /opt/statka/statka.json
sudo systemctl restart statka
```

## âœ¨ ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

- Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ
  - `GET /mytable?my_string=qqq&my_int=123`
  - `POST /my_another_table {"my_string": "qqq", "my_int": 123}`
  - `POST /mytable my_string=qqq&my_int=123`
- Ğ’Ñ‹ ÑĞ°Ğ¼Ğ¸ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚Ğµ, ĞºĞ°ĞºĞ¾Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ± Ğ’Ğ°Ğ¼ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚
- Ğ‘ÑƒÑ„ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ â€” ĞºĞ¾Ğ¿Ğ¸Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ, Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ¾Ñ‚ÑÑ‹Ğ»Ğ°ĞµÑ‚ Ğ±Ğ°Ñ‚Ñ‡ĞµĞ¼
- Retry Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° â€” ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ¾ÑÑŒ, Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ° Ğ¿Ğ¾Ğ·Ğ¶Ğµ, Ğ½Ğ¾ Ğ½Ğµ Ğ±Ğ¾Ğ»ĞµĞµ N-Ñ€Ğ°Ğ·
- ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ `statka.json` â€” Ğ³Ğ¸Ğ±ĞºĞ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
- Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ: `event_time`, `request_id`, `server_hostname`, `client_ip`, `user_agent`. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸, ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ² Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ÑÑ‰ĞµĞ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ 

## ğŸ¯ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

```bash

# Ğ¡Ñ‚Ğ°Ñ€Ñ‚ÑƒĞµĞ¼ ClickHouse Ğ² Ğ´Ğ¾ĞºĞµÑ€Ğµ
# Ğ•ÑĞ»Ğ¸ Ñƒ Ğ’Ğ°Ñ ÑƒĞ¶Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ ClickHouse, Ñ‚Ğ¾ ÑÑ‚Ğ¾Ñ‚ ÑˆĞ°Ğ³ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ
docker run -d -p 9000:9000 --name ch clickhouse/clickhouse-server

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
clickhouse-client --queries-file examples/init.sql

# Ğ—Ğ°Ğ¿ÑƒÑĞº Statka
go run main.go

# ĞŸÑ€Ğ¸ÑÑ‹Ğ»Ğ°ĞµĞ¼ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ! 
# (Ğ·Ğ´ĞµÑÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¿Ğ¸ÑˆÑƒÑ‚ÑÑ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ game_events
# ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ»ÑĞ±ÑƒÑ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ ĞµÑÑ‚ÑŒ Ğ² Ğ²Ğ°ÑˆĞµĞ¹ Ğ‘Ğ” Ğ² ClickHouse)
curl "http://localhost:8080/game_events?player_id=p123\&event_type=level_up\&level=15"

# Ğ§ĞµÑ€ĞµĞ· 5 ÑĞµĞº Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‡Ñ‚Ğ¾ Ğ²ÑÑ‘ Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ¾ Ğ² ClickHouse
clickhouse-client -q "SELECT * FROM game_events FORMAT PrettyCompact"

#    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€event_timeâ”€â”¬â”€request_idâ”€â”¬â”€server_hostnameâ”€â”¬â”€client_ipâ”€â”¬â”€user_agentâ”€â”€â”¬â”€player_idâ”€â”¬â”€event_typeâ”€â”¬â”€levelâ”€â”¬â”€weaponâ”€â”€â”€â”€â”€â”€â”€â”
# 1. â”‚ 2026-01-31 15:33:07.704 â”‚ 9e8b7ddf   â”‚ lavr-A7         â”‚ 127.0.0.1 â”‚ curl/7.81.0 â”‚ p123      â”‚ level_up   â”‚    15 â”‚ ak47         â”‚
# 2. â”‚ 2026-01-31 15:33:07.709 â”‚ 34cd8acf   â”‚ lavr-A7         â”‚ 127.0.0.1 â”‚ curl/7.81.0 â”‚ p456      â”‚ kill       â”‚     0 â”‚ desert_eagle â”‚
# 3. â”‚ 2026-01-31 15:33:07.713 â”‚ 115b6190   â”‚ lavr-A7         â”‚ 127.0.0.1 â”‚ curl/7.81.0 â”‚ p789      â”‚ death      â”‚    10 â”‚              â”‚
# 4. â”‚ 2026-01-31 15:33:07.718 â”‚ 380eb607   â”‚ lavr-A7         â”‚ 127.0.0.1 â”‚ curl/7.81.0 â”‚ p999      â”‚ buy_skin   â”‚     0 â”‚              â”‚
#    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# ĞšĞ°Ğº Ğ²Ğ¸Ğ´Ğ½Ğ¾ Ğ¸Ğ· Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹, Statka Ğ¿Ñ€Ğ¸ÑÑ‹Ğ»Ğ°ĞµÑ‚ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¾Ğº Ğº Ñ‚ĞµĞ¼, Ñ‡Ñ‚Ğ¾ Ñƒ Ğ’Ğ°Ñ ĞµÑÑ‚ÑŒ.
# Ğ•ÑĞ»Ğ¸ ÑÑ‚Ğ¸ ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ñ‹ Ñ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ½Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ, Ñ‚Ğ¾ Ğ¾Ğ½Ğ¸ Ğ½Ğµ Ğ±ÑƒĞ´ÑƒÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑŒÑÑ Ğ¸ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°Ñ‚ÑŒÑÑ
```

## ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ´Ğ»Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
```sql
CREATE TABLE IF NOT EXISTS game_events
(
--     built-in fields
    event_time DateTime64(3),
    request_id String,
    server_hostname LowCardinality(String),
    client_ip String,
    user_agent String,

-- user defined custom fields
    player_id String,
    event_type LowCardinality(String),
    level UInt16,
    weapon String
)
ENGINE = MergeTree
ORDER BY event_time;

CREATE TABLE IF NOT EXISTS purchases
(
    event_time DateTime64(3) DEFAULT now(),
    player_id  String,
    item_id    String,
    item_name  String,
    price      UInt32,
    currency   String
)
ENGINE = MergeTree
ORDER BY event_time;

CREATE TABLE IF NOT EXISTS web_clicks
(
    event_time DateTime64(3),
    session_id String,
    page_url   String,
    user_agent String,
    referrer   String,
    ip         String
)
ENGINE = MergeTree
ORDER BY event_time;
```

## ğŸ“¨ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
### ğŸ® Ğ˜Ğ³Ñ€Ğ¾Ğ²Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
```bash
# GET
curl "http://localhost:8080/game_events?player_id=p123&event_type=level_up&level=15&weapon=ak47"
curl "http://localhost:8080/game_events?player_id=p456&event_type=kill&damage=147&weapon=desert_eagle"

# POST JSON
curl -X POST "http://localhost:8080/game_events" \
  -H "Content-Type: application/json" \
  -d '{"player_id":"p789","event_type":"death","level":10}'

# POST form
curl -X POST "http://localhost:8080/game_events" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "player_id=p999&event_type=buy_skin"
```

### ğŸ›’ ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ¸

```bash
curl -X POST "http://localhost:8080/purchases" \
-H "Content-Type: application/json" \
-d '{"player_id":"p123","item_id":"skin_gold_ak47","item_name":"Golden AK-47","price":499,"currency":"USD"}'

curl "http://localhost:8080/purchases?player_id=p789\&item_id=ammo_9mm\&price=5Â¤cy=USD"
```

### ğŸ‘€ Ğ’ĞµĞ± Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°

```bash
curl "http://localhost:8080/web_clicks?session_id=abc123\&page_url=/shop/weapons\&ip=185.23.45.67"
```

### ğŸŒ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¸Ğ· Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°
```js

async function logEvent(table, data) {
    try {
        const response = await fetch(`http://localhost:8080/${table}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const result = await response.json();
        console.log('âœ… Event logged:', result);  // {ok: 1}
    } catch (error) {
        console.error('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸:', error);
    }
}

// ğŸ® ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
logEvent('game_events', {
    player_id: 'p123',
    event_type: 'level_up',
    level: 15
});

logEvent('purchases', {
    player_id: 'p456',
    item_id: 'skin_gold_ak47',
    price: 499
});
```